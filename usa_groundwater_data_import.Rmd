---
title: "Groundwater Data Files"
author: "Annette Hilton"
date: "10/31/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```
# Introduction 

This document is complimentary to "USA Well Water Data." Please reference "USA Well Water Data" for more information regarding the goals and parameters of the project. 

In this document, we import and work with the USGS groundwater data for all 50 states. 

### Attach packages and other necessary commands 

```{r}
# Attach packages

library(tidyverse)
library(here)

# Disable scientific notation 

options(scipen=999)

```

### Read in data, merge, and tidy 

Read in USGS data for Alabama 

- Alabama groundwater data 
- Alabama secondary data 


```{r}
# Attempt to read in USGS Alabama data file 

alabama_gw_usgs <- read_tsv(here::here("raw_data", "alabama_raw_import.txt"))
```

```{r}
# Attempt to read in Secondary USGS data file 

alabama_other_usgs <- read_tsv(here::here("raw_data", "alabama_raw_other_import.txt"))
```

Merge datasets 

```{r}
# Merge alabama_gw_usgs and alabama_other_usgs data frames using full_join()

alabama_merge <- full_join(alabama_gw_usgs, alabama_other_usgs, by = "site_no", copy = FALSE)

# alabama_merge <- alabama_gw_usgs %>% 
#   full_join(alabama_other_usgs) 


```

Tidy data 


```{r}
# Tidy data to a final version 
# Remove excess columns 
 
alabama_usgs <- alabama_merge %>% 
  select(-lev_tm, -sl_lev_va : -station_nm, -coord_acy_cd, -alt_acy_va) %>% 
  mutate(
      level_date = lubridate::parse_date_time(alabama_merge$lev_dt, orders = c("ymd", "Y!", "Ym"), train = FALSE)) # this works but defaults incomplete dates to january 1st (or the 1st of the month). May not be a problem if I can figure out which ones are truly january...or modify this default? 
  
```

Convert dates 

```{r}
# Create new dataframe to keep these conversions separate 
# Convert date column from character to date ISO format (and so R recognizes as date class)
# Create decimal date from ISO format 
# Make a rule so R keeps NA values and adds 0.5 (half the year, June 15th) to the dates that only have a value for year (missing date and month)
# Separate month and year into their own columns 

alabama_usgs_date <- alabama_usgs %>% 
    mutate(
    level_date = lubridate::ymd(lev_dt),
    level_decimal_date = lubridate::decimal_date(level_date), 
    level_dec_dt_full = case_when(
      !is.na(level_decimal_date) ~ level_decimal_date, 
      is.na(level_decimal_date) ~ as.numeric(lev_dt) + 0.45),
    level_date_new = lubridate::date_decimal(level_dec_dt_full),
    level_month = lubridate::month(level_date_new, label = TRUE),
    level_year = lubridate::year(level_date_new))
   
```






