---
title: "Groundwater Data Files"
author: "Annette Hilton"
date: "10/31/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```
# Introduction 

This document is complimentary to "USA Well Water Data." Please reference "USA Well Water Data" for more information regarding the goals and parameters of the project. 

In this document, I experiment with importing and wrangling data for one state before applying it to all 53 states/territories.  

### Attach packages and other necessary commands 

```{r}
# Attach packages

library(tidyverse)
library(here)

# Disable scientific notation 

options(scipen=999)

```

### Read in data, merge, and tidy 

Read in USGS data for Alabama 

- Alabama groundwater data 
- Alabama secondary data 


```{r}
# Attempt to read in USGS Alabama data file 

# alabama_gw_usgs <- read_tsv(here::here("raw_data", "alabama_raw_import.txt"))
# 
minnesota_gw_usgs <- read_tsv(here::here("test", "minnesota_raw_import.txt"))

# kansas_gw_usgs <- read_tsv(here::here("test", "kansas_raw_import.txt"))
# 
# arkansas_gw_usgs <- read_tsv(here::here("test", "arkansas_raw_import.txt"))

```

```{r}
# Attempt to read in Secondary USGS data file 

# alabama_other_usgs <- read_tsv(here::here("raw_data", "alabama_raw_other_import.txt"))
# 
# minnesota_other_usgs <- read_tsv(here::here("test", "minnesota_raw_other_import.txt"))

# kansas_other_usgs <- read_tsv(here::here("test", "kansas_raw_other_import.txt"))
# 
# arkansas_other_usgs <- read_tsv(here::here("test", "arkansas_raw_other_import.txt"))

#Review Minnesota files (2 other to merge) 

minnesota_other_usgs_1 <- read_tsv(here::here("minnesota_test", "minnesota_well_depth_75m_below_import.txt"))

minnesota_other_usgs_1$site_no <- as.numeric(minnesota_other_usgs_1$site_no)

minnesota_other_usgs_2 <- read_tsv(here::here("minnesota_test", "minnesota_well_depth_74_above_import.txt"))

minnesota_other_full <- read_tsv(here::here("minnesota_test", "minnesota_merged_import.txt")) %>% 
  distinct()
```

Merge datasets 

```{r}
# Merge alabama_gw_usgs and alabama_other_usgs data frames using full_join()

# alabama_merge <- full_join(alabama_gw_usgs, alabama_other_usgs, by = "site_no", copy = FALSE)

minnesota_other_merge <- full_join(minnesota_other_usgs_1, minnesota_other_usgs_2, by = "site_no", copy = FALSE)
# 
minnesota_merge <- full_join(minnesota_gw_usgs, minnesota_other_usgs, by = "site_no", copy = FALSE)

# kansas_merge <- full_join(kansas_gw_usgs, kansas_other_usgs, by = "site_no", copy = FALSE)
# 
# arkansas_merge <- full_join(arkansas_gw_usgs, arkansas_other_usgs, by = "site_no", copy = FALSE)
```

Lat Long Test 

```{r}

lat_long_kansas <- kansas_merge %>% 
  select(site_no, dec_lat_va, dec_long_va) %>% 
  distinct(site_no, .keep_all = TRUE)

lat_long_arkansas <- arkansas_merge %>% 
  select(site_no, dec_lat_va, dec_long_va) %>% 
  distinct(site_no, .keep_all = TRUE)

```


Tidy data 


```{r}
# Tidy data to a final version 
# Remove excess columns 
 
alabama_usgs <- alabama_merge %>% 
  select(-lev_tm, -sl_lev_va : -station_nm, -coord_acy_cd, -alt_acy_va) %>% 
  mutate(
      level_date = lubridate::parse_date_time(alabama_merge$lev_dt, orders = c("ymd", "Y!", "Ym"), train = FALSE)) # this works but defaults incomplete dates to january 1st (or the 1st of the month). May not be a problem if I can figure out which ones are truly january...or modify this default? 
  
```

Convert dates 

```{r}
# Create new dataframe to keep these conversions separate 
# Convert date column from character to date ISO format (and so R recognizes as date class)
# Create decimal date from ISO format 
# Make a rule so R keeps NA values and adds 0.5 (half the year, June 15th) to the dates that only have a value for year (missing date and month)
# Separate month and year into their own columns 

alabama_usgs_date <- alabama_usgs %>% 
    mutate(
    level_date = lubridate::ymd(lev_dt),
    level_decimal_date = lubridate::decimal_date(level_date), 
    level_dec_dt_full = case_when(
      !is.na(level_decimal_date) ~ level_decimal_date, 
      is.na(level_decimal_date) ~ as.numeric(lev_dt) + 0.45),
    level_date_new = lubridate::date_decimal(level_dec_dt_full),
    level_month = lubridate::month(level_date_new, label = TRUE),
    level_year = lubridate::year(level_date_new))
   
```






